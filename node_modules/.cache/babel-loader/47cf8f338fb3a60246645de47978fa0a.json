{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { defineComponent, computed, openBlock, createElementBlock, normalizeClass, unref, Fragment, renderList, toDisplayString, createCommentVNode, createElementVNode, renderSlot } from 'vue';\nimport dayjs from 'dayjs';\nimport localeData from 'dayjs/plugin/localeData.js';\nimport '../../../hooks/index.mjs';\nimport '../../time-picker/index.mjs';\nimport '../../../constants/index.mjs';\nimport { dateTableProps, dateTableEmits, getPrevMonthLastDays, getMonthDays, toNestedArr } from './date-table.mjs';\nimport _export_sfc from '../../../_virtual/plugin-vue_export-helper.mjs';\nimport { useLocale } from '../../../hooks/use-locale/index.mjs';\nimport { useNamespace } from '../../../hooks/use-namespace/index.mjs';\nimport { rangeArr } from '../../time-picker/src/utils.mjs';\nimport { WEEK_DAYS } from '../../../constants/date.mjs';\nconst _hoisted_1 = {\n  key: 0\n};\nconst _hoisted_2 = [\"onClick\"];\n\nconst __default__ = defineComponent({\n  name: \"DateTable\"\n});\n\nconst _sfc_main = /* @__PURE__ */defineComponent({ ...__default__,\n  props: dateTableProps,\n  emits: dateTableEmits,\n\n  setup(__props, {\n    expose,\n    emit\n  }) {\n    const props = __props;\n    dayjs.extend(localeData);\n    const {\n      t,\n      lang\n    } = useLocale();\n    const nsTable = useNamespace(\"calendar-table\");\n    const nsDay = useNamespace(\"calendar-day\");\n    const now = dayjs().locale(lang.value);\n    const firstDayOfWeek = dayjs.localeData().firstDayOfWeek();\n    const isInRange = computed(() => !!props.range && !!props.range.length);\n    const rows = computed(() => {\n      let days = [];\n\n      if (isInRange.value) {\n        const [start, end] = props.range;\n        const currentMonthRange = rangeArr(end.date() - start.date() + 1).map(index => ({\n          text: start.date() + index,\n          type: \"current\"\n        }));\n        let remaining = currentMonthRange.length % 7;\n        remaining = remaining === 0 ? 0 : 7 - remaining;\n        const nextMonthRange = rangeArr(remaining).map((_, index) => ({\n          text: index + 1,\n          type: \"next\"\n        }));\n        days = currentMonthRange.concat(nextMonthRange);\n      } else {\n        const firstDay = props.date.startOf(\"month\").day();\n        const prevMonthDays = getPrevMonthLastDays(props.date, (firstDay - firstDayOfWeek + 7) % 7).map(day => ({\n          text: day,\n          type: \"prev\"\n        }));\n        const currentMonthDays = getMonthDays(props.date).map(day => ({\n          text: day,\n          type: \"current\"\n        }));\n        days = [...prevMonthDays, ...currentMonthDays];\n        const remaining = 7 - (days.length % 7 || 7);\n        const nextMonthDays = rangeArr(remaining).map((_, index) => ({\n          text: index + 1,\n          type: \"next\"\n        }));\n        days = days.concat(nextMonthDays);\n      }\n\n      return toNestedArr(days);\n    });\n    const weekDays = computed(() => {\n      const start = firstDayOfWeek;\n\n      if (start === 0) {\n        return WEEK_DAYS.map(_ => t(`el.datepicker.weeks.${_}`));\n      } else {\n        return WEEK_DAYS.slice(start).concat(WEEK_DAYS.slice(0, start)).map(_ => t(`el.datepicker.weeks.${_}`));\n      }\n    });\n\n    const getFormattedDate = (day, type) => {\n      switch (type) {\n        case \"prev\":\n          return props.date.startOf(\"month\").subtract(1, \"month\").date(day);\n\n        case \"next\":\n          return props.date.startOf(\"month\").add(1, \"month\").date(day);\n\n        case \"current\":\n          return props.date.date(day);\n      }\n    };\n\n    const getCellClass = ({\n      text,\n      type\n    }) => {\n      const classes = [type];\n\n      if (type === \"current\") {\n        const date = getFormattedDate(text, type);\n\n        if (date.isSame(props.selectedDay, \"day\")) {\n          classes.push(nsDay.is(\"selected\"));\n        }\n\n        if (date.isSame(now, \"day\")) {\n          classes.push(nsDay.is(\"today\"));\n        }\n      }\n\n      return classes;\n    };\n\n    const handlePickDay = ({\n      text,\n      type\n    }) => {\n      const date = getFormattedDate(text, type);\n      emit(\"pick\", date);\n    };\n\n    const getSlotData = ({\n      text,\n      type\n    }) => {\n      const day = getFormattedDate(text, type);\n      return {\n        isSelected: day.isSame(props.selectedDay),\n        type: `${type}-month`,\n        day: day.format(\"YYYY-MM-DD\"),\n        date: day.toDate()\n      };\n    };\n\n    expose({\n      getFormattedDate\n    });\n    return (_ctx, _cache) => {\n      return openBlock(), createElementBlock(\"table\", {\n        class: normalizeClass([unref(nsTable).b(), unref(nsTable).is(\"range\", unref(isInRange))]),\n        cellspacing: \"0\",\n        cellpadding: \"0\"\n      }, [!_ctx.hideHeader ? (openBlock(), createElementBlock(\"thead\", _hoisted_1, [(openBlock(true), createElementBlock(Fragment, null, renderList(unref(weekDays), day => {\n        return openBlock(), createElementBlock(\"th\", {\n          key: day\n        }, toDisplayString(day), 1);\n      }), 128))])) : createCommentVNode(\"v-if\", true), createElementVNode(\"tbody\", null, [(openBlock(true), createElementBlock(Fragment, null, renderList(unref(rows), (row, index) => {\n        return openBlock(), createElementBlock(\"tr\", {\n          key: index,\n          class: normalizeClass({\n            [unref(nsTable).e(\"row\")]: true,\n            [unref(nsTable).em(\"row\", \"hide-border\")]: index === 0 && _ctx.hideHeader\n          })\n        }, [(openBlock(true), createElementBlock(Fragment, null, renderList(row, (cell, key) => {\n          return openBlock(), createElementBlock(\"td\", {\n            key,\n            class: normalizeClass(getCellClass(cell)),\n            onClick: $event => handlePickDay(cell)\n          }, [createElementVNode(\"div\", {\n            class: normalizeClass(unref(nsDay).b())\n          }, [renderSlot(_ctx.$slots, \"date-cell\", {\n            data: getSlotData(cell)\n          }, () => [createElementVNode(\"span\", null, toDisplayString(cell.text), 1)])], 2)], 10, _hoisted_2);\n        }), 128))], 2);\n      }), 128))])], 2);\n    };\n  }\n\n});\n\nvar DateTable = /* @__PURE__ */_export_sfc(_sfc_main, [[\"__file\", \"/home/runner/work/element-plus/element-plus/packages/components/calendar/src/date-table.vue\"]]);\n\nexport { DateTable as default };","map":{"version":3,"mappings":"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","names":["name","dayjs","extend","localeData","t","lang","useLocale","useNamespace","now","locale","value","firstDayOfWeek","computed","props","length","days","isInRange","start","end","currentMonthRange","date","map","index","text","type","remaining","nextMonthRange","rangeArr","_","concat","firstDay","startOf","day","getPrevMonthLastDays","currentMonthDays","getMonthDays","prevMonthDays","nextMonthDays","toNestedArr","WEEK_DAYS","slice","subtract","add","getCellClass","getFormattedDate","classes","push","nsDay","is","handlePickDay","emit","getSlotData","isSelected","isSame","selectedDay","toDate","expose"],"sources":["../../../../../../packages/components/calendar/src/date-table.vue"],"sourcesContent":["<template>\n  <table\n    :class=\"[nsTable.b(), nsTable.is('range', isInRange)]\"\n    cellspacing=\"0\"\n    cellpadding=\"0\"\n  >\n    <thead v-if=\"!hideHeader\">\n      <th v-for=\"day in weekDays\" :key=\"day\">{{ day }}</th>\n    </thead>\n\n    <tbody>\n      <tr\n        v-for=\"(row, index) in rows\"\n        :key=\"index\"\n        :class=\"{\n          [nsTable.e('row')]: true,\n          [nsTable.em('row', 'hide-border')]: index === 0 && hideHeader,\n        }\"\n      >\n        <td\n          v-for=\"(cell, key) in row\"\n          :key=\"key\"\n          :class=\"getCellClass(cell)\"\n          @click=\"handlePickDay(cell)\"\n        >\n          <div :class=\"nsDay.b()\">\n            <slot name=\"date-cell\" :data=\"getSlotData(cell)\">\n              <span>{{ cell.text }}</span>\n            </slot>\n          </div>\n        </td>\n      </tr>\n    </tbody>\n  </table>\n</template>\n\n<script lang=\"ts\" setup>\nimport { computed } from 'vue'\nimport dayjs from 'dayjs'\nimport localeData from 'dayjs/plugin/localeData.js'\nimport { useLocale, useNamespace } from '@element-plus/hooks'\nimport { rangeArr } from '@element-plus/components/time-picker'\nimport { WEEK_DAYS } from '@element-plus/constants'\nimport {\n  dateTableEmits,\n  dateTableProps,\n  getMonthDays,\n  getPrevMonthLastDays,\n  toNestedArr,\n} from './date-table'\n\nimport type { CalendarDateCell, CalendarDateCellType } from './date-table'\nimport type { Dayjs } from 'dayjs'\n\ndefineOptions({\n  name: 'DateTable',\n})\n\nconst props = defineProps(dateTableProps)\nconst emit = defineEmits(dateTableEmits)\n\ndayjs.extend(localeData)\n\nconst { t, lang } = useLocale()\nconst nsTable = useNamespace('calendar-table')\nconst nsDay = useNamespace('calendar-day')\n\nconst now = dayjs().locale(lang.value)\n// https://day.js.org/docs/en/i18n/locale-data\nconst firstDayOfWeek: number = dayjs.localeData().firstDayOfWeek()\n\nconst isInRange = computed(() => !!props.range && !!props.range.length)\n\nconst rows = computed(() => {\n  let days: CalendarDateCell[] = []\n  if (isInRange.value) {\n    const [start, end] = props.range!\n    const currentMonthRange: CalendarDateCell[] = rangeArr(\n      end.date() - start.date() + 1\n    ).map((index) => ({\n      text: start.date() + index,\n      type: 'current',\n    }))\n\n    let remaining = currentMonthRange.length % 7\n    remaining = remaining === 0 ? 0 : 7 - remaining\n    const nextMonthRange: CalendarDateCell[] = rangeArr(remaining).map(\n      (_, index) => ({\n        text: index + 1,\n        type: 'next',\n      })\n    )\n    days = currentMonthRange.concat(nextMonthRange)\n  } else {\n    const firstDay = props.date.startOf('month').day()\n    const prevMonthDays: CalendarDateCell[] = getPrevMonthLastDays(\n      props.date,\n      (firstDay - firstDayOfWeek + 7) % 7\n    ).map((day) => ({\n      text: day,\n      type: 'prev',\n    }))\n    const currentMonthDays: CalendarDateCell[] = getMonthDays(props.date).map(\n      (day) => ({\n        text: day,\n        type: 'current',\n      })\n    )\n    days = [...prevMonthDays, ...currentMonthDays]\n    const remaining = 7 - (days.length % 7 || 7)\n    const nextMonthDays: CalendarDateCell[] = rangeArr(remaining).map(\n      (_, index) => ({\n        text: index + 1,\n        type: 'next',\n      })\n    )\n    days = days.concat(nextMonthDays)\n  }\n  return toNestedArr(days)\n})\n\nconst weekDays = computed(() => {\n  const start = firstDayOfWeek\n  if (start === 0) {\n    return WEEK_DAYS.map((_) => t(`el.datepicker.weeks.${_}`))\n  } else {\n    return WEEK_DAYS.slice(start)\n      .concat(WEEK_DAYS.slice(0, start))\n      .map((_) => t(`el.datepicker.weeks.${_}`))\n  }\n})\n\nconst getFormattedDate = (day: number, type: CalendarDateCellType): Dayjs => {\n  switch (type) {\n    case 'prev':\n      return props.date.startOf('month').subtract(1, 'month').date(day)\n    case 'next':\n      return props.date.startOf('month').add(1, 'month').date(day)\n    case 'current':\n      return props.date.date(day)\n  }\n}\n\nconst getCellClass = ({ text, type }: CalendarDateCell) => {\n  const classes: string[] = [type]\n  if (type === 'current') {\n    const date = getFormattedDate(text, type)\n    if (date.isSame(props.selectedDay, 'day')) {\n      classes.push(nsDay.is('selected'))\n    }\n    if (date.isSame(now, 'day')) {\n      classes.push(nsDay.is('today'))\n    }\n  }\n  return classes\n}\n\nconst handlePickDay = ({ text, type }: CalendarDateCell) => {\n  const date = getFormattedDate(text, type)\n  emit('pick', date)\n}\n\nconst getSlotData = ({ text, type }: CalendarDateCell) => {\n  const day = getFormattedDate(text, type)\n  return {\n    isSelected: day.isSame(props.selectedDay),\n    type: `${type}-month`,\n    day: day.format('YYYY-MM-DD'),\n    date: day.toDate(),\n  }\n}\n\ndefineExpose({\n  /** @description toggle date panel */\n  getFormattedDate,\n})\n</script>\n"]},"metadata":{},"sourceType":"module"}