{"ast":null,"code":"import { defineComponent, inject, ref, watch, nextTick, computed, unref, provide, openBlock, createBlock, mergeProps, withCtx, normalizeClass, normalizeStyle, withModifiers, resolveDynamicComponent, createCommentVNode, createElementBlock, createElementVNode, renderSlot, toDisplayString } from 'vue';\nimport { isEqual } from 'lodash-unified';\nimport { onClickOutside } from '@vueuse/core';\nimport '../../../../hooks/index.mjs';\nimport { ElInput } from '../../../input/index.mjs';\nimport { ElIcon } from '../../../icon/index.mjs';\nimport { ElTooltip } from '../../../tooltip/index.mjs';\nimport '../../../../utils/index.mjs';\nimport '../../../../constants/index.mjs';\nimport { Clock, Calendar } from '@element-plus/icons-vue';\nimport { valueEquals, formatter, parseDate } from '../utils.mjs';\nimport { timePickerDefaultProps } from './props.mjs';\nimport _export_sfc from '../../../../_virtual/plugin-vue_export-helper.mjs';\nimport { useLocale } from '../../../../hooks/use-locale/index.mjs';\nimport { useNamespace } from '../../../../hooks/use-namespace/index.mjs';\nimport { useFormItem } from '../../../../hooks/use-form-item/index.mjs';\nimport { debugWarn } from '../../../../utils/error.mjs';\nimport { isArray } from '@vue/shared';\nimport { EVENT_CODE } from '../../../../constants/aria.mjs';\nimport { useSize } from '../../../../hooks/use-common-props/index.mjs';\nconst _hoisted_1 = [\"id\", \"name\", \"placeholder\", \"value\", \"disabled\", \"readonly\"];\nconst _hoisted_2 = [\"id\", \"name\", \"placeholder\", \"value\", \"disabled\", \"readonly\"];\n\nconst __default__ = defineComponent({\n  name: \"Picker\"\n});\n\nconst _sfc_main = /* @__PURE__ */defineComponent({ ...__default__,\n  props: timePickerDefaultProps,\n  emits: [\"update:modelValue\", \"change\", \"focus\", \"blur\", \"calendar-change\", \"panel-change\", \"visible-change\", \"keydown\"],\n\n  setup(__props, {\n    expose,\n    emit\n  }) {\n    const props = __props;\n    const {\n      lang\n    } = useLocale();\n    const nsDate = useNamespace(\"date\");\n    const nsInput = useNamespace(\"input\");\n    const nsRange = useNamespace(\"range\");\n    const {\n      form,\n      formItem\n    } = useFormItem();\n    const elPopperOptions = inject(\"ElPopperOptions\", {});\n    const refPopper = ref();\n    const inputRef = ref();\n    const pickerVisible = ref(false);\n    const pickerActualVisible = ref(false);\n    const valueOnOpen = ref(null);\n    let hasJustTabExitedInput = false;\n    let ignoreFocusEvent = false;\n    watch(pickerVisible, val => {\n      if (!val) {\n        userInput.value = null;\n        nextTick(() => {\n          emitChange(props.modelValue);\n        });\n      } else {\n        nextTick(() => {\n          if (val) {\n            valueOnOpen.value = props.modelValue;\n          }\n        });\n      }\n    });\n\n    const emitChange = (val, isClear) => {\n      if (isClear || !valueEquals(val, valueOnOpen.value)) {\n        emit(\"change\", val);\n        props.validateEvent && (formItem == null ? void 0 : formItem.validate(\"change\").catch(err => debugWarn(err)));\n      }\n    };\n\n    const emitInput = input => {\n      if (!valueEquals(props.modelValue, input)) {\n        let formatted;\n\n        if (isArray(input)) {\n          formatted = input.map(item => formatter(item, props.valueFormat, lang.value));\n        } else if (input) {\n          formatted = formatter(input, props.valueFormat, lang.value);\n        }\n\n        emit(\"update:modelValue\", input ? formatted : input, lang.value);\n      }\n    };\n\n    const emitKeydown = e => {\n      emit(\"keydown\", e);\n    };\n\n    const refInput = computed(() => {\n      if (inputRef.value) {\n        const _r = isRangeInput.value ? inputRef.value : inputRef.value.$el;\n\n        return Array.from(_r.querySelectorAll(\"input\"));\n      }\n\n      return [];\n    });\n\n    const setSelectionRange = (start, end, pos) => {\n      const _inputs = refInput.value;\n      if (!_inputs.length) return;\n\n      if (!pos || pos === \"min\") {\n        _inputs[0].setSelectionRange(start, end);\n\n        _inputs[0].focus();\n      } else if (pos === \"max\") {\n        _inputs[1].setSelectionRange(start, end);\n\n        _inputs[1].focus();\n      }\n    };\n\n    const focusOnInputBox = () => {\n      focus(true, true);\n      nextTick(() => {\n        ignoreFocusEvent = false;\n      });\n    };\n\n    const onPick = (date = \"\", visible = false) => {\n      if (!visible) {\n        ignoreFocusEvent = true;\n      }\n\n      pickerVisible.value = visible;\n      let result;\n\n      if (isArray(date)) {\n        result = date.map(_ => _.toDate());\n      } else {\n        result = date ? date.toDate() : date;\n      }\n\n      userInput.value = null;\n      emitInput(result);\n    };\n\n    const onBeforeShow = () => {\n      pickerActualVisible.value = true;\n    };\n\n    const onShow = () => {\n      emit(\"visible-change\", true);\n    };\n\n    const onKeydownPopperContent = event => {\n      if ((event == null ? void 0 : event.key) === EVENT_CODE.esc) {\n        focus(true, true);\n      }\n    };\n\n    const onHide = () => {\n      pickerActualVisible.value = false;\n      pickerVisible.value = false;\n      ignoreFocusEvent = false;\n      emit(\"visible-change\", false);\n    };\n\n    const handleOpen = () => {\n      pickerVisible.value = true;\n    };\n\n    const handleClose = () => {\n      pickerVisible.value = false;\n    };\n\n    const focus = (focusStartInput = true, isIgnoreFocusEvent = false) => {\n      ignoreFocusEvent = isIgnoreFocusEvent;\n      const [leftInput, rightInput] = unref(refInput);\n      let input = leftInput;\n\n      if (!focusStartInput && isRangeInput.value) {\n        input = rightInput;\n      }\n\n      if (input) {\n        input.focus();\n      }\n    };\n\n    const handleFocusInput = e => {\n      if (props.readonly || pickerDisabled.value || pickerVisible.value || ignoreFocusEvent) {\n        return;\n      }\n\n      pickerVisible.value = true;\n      emit(\"focus\", e);\n    };\n\n    let currentHandleBlurDeferCallback = void 0;\n\n    const handleBlurInput = e => {\n      const handleBlurDefer = async () => {\n        setTimeout(() => {\n          var _a;\n\n          if (currentHandleBlurDeferCallback === handleBlurDefer) {\n            if (!(((_a = refPopper.value) == null ? void 0 : _a.isFocusInsideContent()) && !hasJustTabExitedInput) && refInput.value.filter(input => {\n              return input.contains(document.activeElement);\n            }).length === 0) {\n              handleChange();\n              pickerVisible.value = false;\n              emit(\"blur\", e);\n              props.validateEvent && (formItem == null ? void 0 : formItem.validate(\"blur\").catch(err => debugWarn(err)));\n            }\n\n            hasJustTabExitedInput = false;\n          }\n        }, 0);\n      };\n\n      currentHandleBlurDeferCallback = handleBlurDefer;\n      handleBlurDefer();\n    };\n\n    const pickerDisabled = computed(() => {\n      return props.disabled || (form == null ? void 0 : form.disabled);\n    });\n    const parsedValue = computed(() => {\n      let dayOrDays;\n\n      if (valueIsEmpty.value) {\n        if (pickerOptions.value.getDefaultValue) {\n          dayOrDays = pickerOptions.value.getDefaultValue();\n        }\n      } else {\n        if (isArray(props.modelValue)) {\n          dayOrDays = props.modelValue.map(d => parseDate(d, props.valueFormat, lang.value));\n        } else {\n          dayOrDays = parseDate(props.modelValue, props.valueFormat, lang.value);\n        }\n      }\n\n      if (pickerOptions.value.getRangeAvailableTime) {\n        const availableResult = pickerOptions.value.getRangeAvailableTime(dayOrDays);\n\n        if (!isEqual(availableResult, dayOrDays)) {\n          dayOrDays = availableResult;\n          emitInput(isArray(dayOrDays) ? dayOrDays.map(_ => _.toDate()) : dayOrDays.toDate());\n        }\n      }\n\n      if (isArray(dayOrDays) && dayOrDays.some(day => !day)) {\n        dayOrDays = [];\n      }\n\n      return dayOrDays;\n    });\n    const displayValue = computed(() => {\n      if (!pickerOptions.value.panelReady) return \"\";\n      const formattedValue = formatDayjsToString(parsedValue.value);\n\n      if (isArray(userInput.value)) {\n        return [userInput.value[0] || formattedValue && formattedValue[0] || \"\", userInput.value[1] || formattedValue && formattedValue[1] || \"\"];\n      } else if (userInput.value !== null) {\n        return userInput.value;\n      }\n\n      if (!isTimePicker.value && valueIsEmpty.value) return \"\";\n      if (!pickerVisible.value && valueIsEmpty.value) return \"\";\n\n      if (formattedValue) {\n        return isDatesPicker.value ? formattedValue.join(\", \") : formattedValue;\n      }\n\n      return \"\";\n    });\n    const isTimeLikePicker = computed(() => props.type.includes(\"time\"));\n    const isTimePicker = computed(() => props.type.startsWith(\"time\"));\n    const isDatesPicker = computed(() => props.type === \"dates\");\n    const triggerIcon = computed(() => props.prefixIcon || (isTimeLikePicker.value ? Clock : Calendar));\n    const showClose = ref(false);\n\n    const onClearIconClick = event => {\n      if (props.readonly || pickerDisabled.value) return;\n\n      if (showClose.value) {\n        event.stopPropagation();\n        focusOnInputBox();\n        emitInput(null);\n        emitChange(null, true);\n        showClose.value = false;\n        pickerVisible.value = false;\n        pickerOptions.value.handleClear && pickerOptions.value.handleClear();\n      }\n    };\n\n    const valueIsEmpty = computed(() => {\n      const {\n        modelValue\n      } = props;\n      return !modelValue || isArray(modelValue) && !modelValue.filter(Boolean).length;\n    });\n\n    const onMouseDownInput = async event => {\n      var _a;\n\n      if (props.readonly || pickerDisabled.value) return;\n\n      if (((_a = event.target) == null ? void 0 : _a.tagName) !== \"INPUT\" || refInput.value.includes(document.activeElement)) {\n        pickerVisible.value = true;\n      }\n    };\n\n    const onMouseEnter = () => {\n      if (props.readonly || pickerDisabled.value) return;\n\n      if (!valueIsEmpty.value && props.clearable) {\n        showClose.value = true;\n      }\n    };\n\n    const onMouseLeave = () => {\n      showClose.value = false;\n    };\n\n    const onTouchStartInput = event => {\n      var _a;\n\n      if (((_a = event.touches[0].target) == null ? void 0 : _a.tagName) !== \"INPUT\" || refInput.value.includes(document.activeElement)) {\n        pickerVisible.value = true;\n      }\n    };\n\n    const isRangeInput = computed(() => {\n      return props.type.includes(\"range\");\n    });\n    const pickerSize = useSize();\n    const popperEl = computed(() => {\n      var _a, _b;\n\n      return (_b = (_a = unref(refPopper)) == null ? void 0 : _a.popperRef) == null ? void 0 : _b.contentRef;\n    });\n    const actualInputRef = computed(() => {\n      var _a;\n\n      if (unref(isRangeInput)) {\n        return unref(inputRef);\n      }\n\n      return (_a = unref(inputRef)) == null ? void 0 : _a.$el;\n    });\n    onClickOutside(actualInputRef, e => {\n      const unrefedPopperEl = unref(popperEl);\n      const inputEl = unref(actualInputRef);\n      if (unrefedPopperEl && (e.target === unrefedPopperEl || e.composedPath().includes(unrefedPopperEl)) || e.target === inputEl || e.composedPath().includes(inputEl)) return;\n      pickerVisible.value = false;\n    });\n    const userInput = ref(null);\n\n    const handleChange = () => {\n      if (userInput.value) {\n        const value = parseUserInputToDayjs(displayValue.value);\n\n        if (value) {\n          if (isValidValue(value)) {\n            emitInput(isArray(value) ? value.map(_ => _.toDate()) : value.toDate());\n            userInput.value = null;\n          }\n        }\n      }\n\n      if (userInput.value === \"\") {\n        emitInput(null);\n        emitChange(null);\n        userInput.value = null;\n      }\n    };\n\n    const parseUserInputToDayjs = value => {\n      if (!value) return null;\n      return pickerOptions.value.parseUserInput(value);\n    };\n\n    const formatDayjsToString = value => {\n      if (!value) return null;\n      return pickerOptions.value.formatToString(value);\n    };\n\n    const isValidValue = value => {\n      return pickerOptions.value.isValidValue(value);\n    };\n\n    const handleKeydownInput = async event => {\n      if (props.readonly || pickerDisabled.value) return;\n      const {\n        code\n      } = event;\n      emitKeydown(event);\n\n      if (code === EVENT_CODE.esc) {\n        if (pickerVisible.value === true) {\n          pickerVisible.value = false;\n          event.preventDefault();\n          event.stopPropagation();\n        }\n\n        return;\n      }\n\n      if (code === EVENT_CODE.down) {\n        if (pickerOptions.value.handleFocusPicker) {\n          event.preventDefault();\n          event.stopPropagation();\n        }\n\n        if (pickerVisible.value === false) {\n          pickerVisible.value = true;\n          await nextTick();\n        }\n\n        if (pickerOptions.value.handleFocusPicker) {\n          pickerOptions.value.handleFocusPicker();\n          return;\n        }\n      }\n\n      if (code === EVENT_CODE.tab) {\n        hasJustTabExitedInput = true;\n        return;\n      }\n\n      if (code === EVENT_CODE.enter || code === EVENT_CODE.numpadEnter) {\n        if (userInput.value === null || userInput.value === \"\" || isValidValue(parseUserInputToDayjs(displayValue.value))) {\n          handleChange();\n          pickerVisible.value = false;\n        }\n\n        event.stopPropagation();\n        return;\n      }\n\n      if (userInput.value) {\n        event.stopPropagation();\n        return;\n      }\n\n      if (pickerOptions.value.handleKeydownInput) {\n        pickerOptions.value.handleKeydownInput(event);\n      }\n    };\n\n    const onUserInput = e => {\n      userInput.value = e;\n\n      if (!pickerVisible.value) {\n        pickerVisible.value = true;\n      }\n    };\n\n    const handleStartInput = event => {\n      const target = event.target;\n\n      if (userInput.value) {\n        userInput.value = [target.value, userInput.value[1]];\n      } else {\n        userInput.value = [target.value, null];\n      }\n    };\n\n    const handleEndInput = event => {\n      const target = event.target;\n\n      if (userInput.value) {\n        userInput.value = [userInput.value[0], target.value];\n      } else {\n        userInput.value = [null, target.value];\n      }\n    };\n\n    const handleStartChange = () => {\n      var _a;\n\n      const values = userInput.value;\n      const value = parseUserInputToDayjs(values && values[0]);\n      const parsedVal = unref(parsedValue);\n\n      if (value && value.isValid()) {\n        userInput.value = [formatDayjsToString(value), ((_a = displayValue.value) == null ? void 0 : _a[1]) || null];\n        const newValue = [value, parsedVal && (parsedVal[1] || null)];\n\n        if (isValidValue(newValue)) {\n          emitInput(newValue);\n          userInput.value = null;\n        }\n      }\n    };\n\n    const handleEndChange = () => {\n      var _a;\n\n      const values = unref(userInput);\n      const value = parseUserInputToDayjs(values && values[1]);\n      const parsedVal = unref(parsedValue);\n\n      if (value && value.isValid()) {\n        userInput.value = [((_a = unref(displayValue)) == null ? void 0 : _a[0]) || null, formatDayjsToString(value)];\n        const newValue = [parsedVal && parsedVal[0], value];\n\n        if (isValidValue(newValue)) {\n          emitInput(newValue);\n          userInput.value = null;\n        }\n      }\n    };\n\n    const pickerOptions = ref({});\n\n    const onSetPickerOption = e => {\n      pickerOptions.value[e[0]] = e[1];\n      pickerOptions.value.panelReady = true;\n    };\n\n    const onCalendarChange = e => {\n      emit(\"calendar-change\", e);\n    };\n\n    const onPanelChange = (value, mode, view) => {\n      emit(\"panel-change\", value, mode, view);\n    };\n\n    provide(\"EP_PICKER_BASE\", {\n      props\n    });\n    expose({\n      focus,\n      handleFocusInput,\n      handleBlurInput,\n      handleOpen,\n      handleClose,\n      onPick\n    });\n    return (_ctx, _cache) => {\n      return openBlock(), createBlock(unref(ElTooltip), mergeProps({\n        ref_key: \"refPopper\",\n        ref: refPopper,\n        visible: pickerVisible.value,\n        effect: \"light\",\n        pure: \"\",\n        trigger: \"click\"\n      }, _ctx.$attrs, {\n        role: \"dialog\",\n        teleported: \"\",\n        transition: `${unref(nsDate).namespace.value}-zoom-in-top`,\n        \"popper-class\": [`${unref(nsDate).namespace.value}-picker__popper`, _ctx.popperClass],\n        \"popper-options\": unref(elPopperOptions),\n        \"fallback-placements\": [\"bottom\", \"top\", \"right\", \"left\"],\n        \"gpu-acceleration\": false,\n        \"stop-popper-mouse-event\": false,\n        \"hide-after\": 0,\n        persistent: \"\",\n        onBeforeShow,\n        onShow,\n        onHide\n      }), {\n        default: withCtx(() => [!unref(isRangeInput) ? (openBlock(), createBlock(unref(ElInput), {\n          key: 0,\n          id: _ctx.id,\n          ref_key: \"inputRef\",\n          ref: inputRef,\n          \"container-role\": \"combobox\",\n          \"model-value\": unref(displayValue),\n          name: _ctx.name,\n          size: unref(pickerSize),\n          disabled: unref(pickerDisabled),\n          placeholder: _ctx.placeholder,\n          class: normalizeClass([unref(nsDate).b(\"editor\"), unref(nsDate).bm(\"editor\", _ctx.type), _ctx.$attrs.class]),\n          style: normalizeStyle(_ctx.$attrs.style),\n          readonly: !_ctx.editable || _ctx.readonly || unref(isDatesPicker) || _ctx.type === \"week\",\n          label: _ctx.label,\n          tabindex: _ctx.tabindex,\n          \"validate-event\": false,\n          onInput: onUserInput,\n          onFocus: handleFocusInput,\n          onBlur: handleBlurInput,\n          onKeydown: handleKeydownInput,\n          onChange: handleChange,\n          onMousedown: onMouseDownInput,\n          onMouseenter: onMouseEnter,\n          onMouseleave: onMouseLeave,\n          onTouchstart: onTouchStartInput,\n          onClick: _cache[0] || (_cache[0] = withModifiers(() => {}, [\"stop\"]))\n        }, {\n          prefix: withCtx(() => [unref(triggerIcon) ? (openBlock(), createBlock(unref(ElIcon), {\n            key: 0,\n            class: normalizeClass(unref(nsInput).e(\"icon\")),\n            onMousedown: withModifiers(onMouseDownInput, [\"prevent\"]),\n            onTouchstart: onTouchStartInput\n          }, {\n            default: withCtx(() => [(openBlock(), createBlock(resolveDynamicComponent(unref(triggerIcon))))]),\n            _: 1\n          }, 8, [\"class\", \"onMousedown\"])) : createCommentVNode(\"v-if\", true)]),\n          suffix: withCtx(() => [showClose.value && _ctx.clearIcon ? (openBlock(), createBlock(unref(ElIcon), {\n            key: 0,\n            class: normalizeClass(`${unref(nsInput).e(\"icon\")} clear-icon`),\n            onClick: withModifiers(onClearIconClick, [\"stop\"])\n          }, {\n            default: withCtx(() => [(openBlock(), createBlock(resolveDynamicComponent(_ctx.clearIcon)))]),\n            _: 1\n          }, 8, [\"class\", \"onClick\"])) : createCommentVNode(\"v-if\", true)]),\n          _: 1\n        }, 8, [\"id\", \"model-value\", \"name\", \"size\", \"disabled\", \"placeholder\", \"class\", \"style\", \"readonly\", \"label\", \"tabindex\", \"onKeydown\"])) : (openBlock(), createElementBlock(\"div\", {\n          key: 1,\n          ref_key: \"inputRef\",\n          ref: inputRef,\n          class: normalizeClass([unref(nsDate).b(\"editor\"), unref(nsDate).bm(\"editor\", _ctx.type), unref(nsInput).e(\"wrapper\"), unref(nsDate).is(\"disabled\", unref(pickerDisabled)), unref(nsDate).is(\"active\", pickerVisible.value), unref(nsRange).b(\"editor\"), unref(pickerSize) ? unref(nsRange).bm(\"editor\", unref(pickerSize)) : \"\", _ctx.$attrs.class]),\n          style: normalizeStyle(_ctx.$attrs.style),\n          onClick: handleFocusInput,\n          onMouseenter: onMouseEnter,\n          onMouseleave: onMouseLeave,\n          onTouchstart: onTouchStartInput,\n          onKeydown: handleKeydownInput\n        }, [unref(triggerIcon) ? (openBlock(), createBlock(unref(ElIcon), {\n          key: 0,\n          class: normalizeClass([unref(nsInput).e(\"icon\"), unref(nsRange).e(\"icon\")]),\n          onMousedown: withModifiers(onMouseDownInput, [\"prevent\"]),\n          onTouchstart: onTouchStartInput\n        }, {\n          default: withCtx(() => [(openBlock(), createBlock(resolveDynamicComponent(unref(triggerIcon))))]),\n          _: 1\n        }, 8, [\"class\", \"onMousedown\"])) : createCommentVNode(\"v-if\", true), createElementVNode(\"input\", {\n          id: _ctx.id && _ctx.id[0],\n          autocomplete: \"off\",\n          name: _ctx.name && _ctx.name[0],\n          placeholder: _ctx.startPlaceholder,\n          value: unref(displayValue) && unref(displayValue)[0],\n          disabled: unref(pickerDisabled),\n          readonly: !_ctx.editable || _ctx.readonly,\n          class: normalizeClass(unref(nsRange).b(\"input\")),\n          onMousedown: onMouseDownInput,\n          onInput: handleStartInput,\n          onChange: handleStartChange,\n          onFocus: handleFocusInput,\n          onBlur: handleBlurInput\n        }, null, 42, _hoisted_1), renderSlot(_ctx.$slots, \"range-separator\", {}, () => [createElementVNode(\"span\", {\n          class: normalizeClass(unref(nsRange).b(\"separator\"))\n        }, toDisplayString(_ctx.rangeSeparator), 3)]), createElementVNode(\"input\", {\n          id: _ctx.id && _ctx.id[1],\n          autocomplete: \"off\",\n          name: _ctx.name && _ctx.name[1],\n          placeholder: _ctx.endPlaceholder,\n          value: unref(displayValue) && unref(displayValue)[1],\n          disabled: unref(pickerDisabled),\n          readonly: !_ctx.editable || _ctx.readonly,\n          class: normalizeClass(unref(nsRange).b(\"input\")),\n          onMousedown: onMouseDownInput,\n          onFocus: handleFocusInput,\n          onBlur: handleBlurInput,\n          onInput: handleEndInput,\n          onChange: handleEndChange\n        }, null, 42, _hoisted_2), _ctx.clearIcon ? (openBlock(), createBlock(unref(ElIcon), {\n          key: 1,\n          class: normalizeClass([unref(nsInput).e(\"icon\"), unref(nsRange).e(\"close-icon\"), {\n            [unref(nsRange).e(\"close-icon--hidden\")]: !showClose.value\n          }]),\n          onClick: onClearIconClick\n        }, {\n          default: withCtx(() => [(openBlock(), createBlock(resolveDynamicComponent(_ctx.clearIcon)))]),\n          _: 1\n        }, 8, [\"class\"])) : createCommentVNode(\"v-if\", true)], 38))]),\n        content: withCtx(() => [renderSlot(_ctx.$slots, \"default\", {\n          visible: pickerVisible.value,\n          actualVisible: pickerActualVisible.value,\n          parsedValue: unref(parsedValue),\n          format: _ctx.format,\n          unlinkPanels: _ctx.unlinkPanels,\n          type: _ctx.type,\n          defaultValue: _ctx.defaultValue,\n          onPick,\n          onSelectRange: setSelectionRange,\n          onSetPickerOption,\n          onCalendarChange,\n          onPanelChange,\n          onKeydown: onKeydownPopperContent,\n          onMousedown: _cache[1] || (_cache[1] = withModifiers(() => {}, [\"stop\"]))\n        })]),\n        _: 3\n      }, 16, [\"visible\", \"transition\", \"popper-class\", \"popper-options\"]);\n    };\n  }\n\n});\n\nvar CommonPicker = /* @__PURE__ */_export_sfc(_sfc_main, [[\"__file\", \"/home/runner/work/element-plus/element-plus/packages/components/time-picker/src/common/picker.vue\"]]);\n\nexport { CommonPicker as default };","map":{"version":3,"mappings":"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","names":["name","lang","useLocale","useNamespace","form","formItem","useFormItem","elPopperOptions","refPopper","ref","inputRef","hasJustTabExitedInput","ignoreFocusEvent","watch","val","userInput","value","nextTick","emitChange","props","modelValue","valueOnOpen","isClear","valueEquals","emit","catch","err","input","formatted","map","item","formatter","e","computed","_r","isRangeInput","$el","Array","setSelectionRange","start","end","pos","_inputs","refInput","focus","focusOnInputBox","onPick","date","visible","pickerVisible","result","_","toDate","emitInput","onBeforeShow","pickerActualVisible","onShow","event","EVENT_CODE","onHide","handleOpen","handleClose","focusStartInput","isIgnoreFocusEvent","leftInput","rightInput","unref","readonly","pickerDisabled","currentHandleBlurDeferCallback","handleBlurDefer","setTimeout","_a","contains","document","length","handleChange","dayOrDays","getRangeAvailableTime","availableResult","formattedValue","isTimeLikePicker","includes","isTimePicker","showClose","pickerOptions","_b","onClickOutside","parseUserInput","isValidValue","code","emitKeydown","preventDefault","stopPropagation","handleKeydownInput","target","formatDayjsToString","parsedVal","parseUserInputToDayjs","provide"],"sources":["../../../../../../../packages/components/time-picker/src/common/picker.vue"],"sourcesContent":["<template>\n  <el-tooltip\n    ref=\"refPopper\"\n    :visible=\"pickerVisible\"\n    effect=\"light\"\n    pure\n    trigger=\"click\"\n    v-bind=\"$attrs\"\n    role=\"dialog\"\n    teleported\n    :transition=\"`${nsDate.namespace.value}-zoom-in-top`\"\n    :popper-class=\"[`${nsDate.namespace.value}-picker__popper`, popperClass]\"\n    :popper-options=\"elPopperOptions\"\n    :fallback-placements=\"['bottom', 'top', 'right', 'left']\"\n    :gpu-acceleration=\"false\"\n    :stop-popper-mouse-event=\"false\"\n    :hide-after=\"0\"\n    persistent\n    @before-show=\"onBeforeShow\"\n    @show=\"onShow\"\n    @hide=\"onHide\"\n  >\n    <template #default>\n      <el-input\n        v-if=\"!isRangeInput\"\n        :id=\"(id as string | undefined)\"\n        ref=\"inputRef\"\n        container-role=\"combobox\"\n        :model-value=\"(displayValue as string)\"\n        :name=\"name\"\n        :size=\"pickerSize\"\n        :disabled=\"pickerDisabled\"\n        :placeholder=\"placeholder\"\n        :class=\"[nsDate.b('editor'), nsDate.bm('editor', type), $attrs.class]\"\n        :style=\"$attrs.style\"\n        :readonly=\"!editable || readonly || isDatesPicker || type === 'week'\"\n        :label=\"label\"\n        :tabindex=\"tabindex\"\n        :validate-event=\"false\"\n        @input=\"onUserInput\"\n        @focus=\"handleFocusInput\"\n        @blur=\"handleBlurInput\"\n        @keydown=\"\n          //\n          handleKeydownInput as any\n        \"\n        @change=\"handleChange\"\n        @mousedown=\"onMouseDownInput\"\n        @mouseenter=\"onMouseEnter\"\n        @mouseleave=\"onMouseLeave\"\n        @touchstart=\"onTouchStartInput\"\n        @click.stop\n      >\n        <template #prefix>\n          <el-icon\n            v-if=\"triggerIcon\"\n            :class=\"nsInput.e('icon')\"\n            @mousedown.prevent=\"onMouseDownInput\"\n            @touchstart=\"onTouchStartInput\"\n          >\n            <component :is=\"triggerIcon\" />\n          </el-icon>\n        </template>\n        <template #suffix>\n          <el-icon\n            v-if=\"showClose && clearIcon\"\n            :class=\"`${nsInput.e('icon')} clear-icon`\"\n            @click.stop=\"onClearIconClick\"\n          >\n            <component :is=\"clearIcon\" />\n          </el-icon>\n        </template>\n      </el-input>\n      <div\n        v-else\n        ref=\"inputRef\"\n        :class=\"[\n          nsDate.b('editor'),\n          nsDate.bm('editor', type),\n          nsInput.e('wrapper'),\n          nsDate.is('disabled', pickerDisabled),\n          nsDate.is('active', pickerVisible),\n          nsRange.b('editor'),\n          pickerSize ? nsRange.bm('editor', pickerSize) : '',\n          $attrs.class,\n        ]\"\n        :style=\"($attrs.style as any)\"\n        @click=\"handleFocusInput\"\n        @mouseenter=\"onMouseEnter\"\n        @mouseleave=\"onMouseLeave\"\n        @touchstart=\"onTouchStartInput\"\n        @keydown=\"handleKeydownInput\"\n      >\n        <el-icon\n          v-if=\"triggerIcon\"\n          :class=\"[nsInput.e('icon'), nsRange.e('icon')]\"\n          @mousedown.prevent=\"onMouseDownInput\"\n          @touchstart=\"onTouchStartInput\"\n        >\n          <component :is=\"triggerIcon\" />\n        </el-icon>\n        <input\n          :id=\"id && id[0]\"\n          autocomplete=\"off\"\n          :name=\"name && name[0]\"\n          :placeholder=\"startPlaceholder\"\n          :value=\"displayValue && displayValue[0]\"\n          :disabled=\"pickerDisabled\"\n          :readonly=\"!editable || readonly\"\n          :class=\"nsRange.b('input')\"\n          @mousedown=\"onMouseDownInput\"\n          @input=\"handleStartInput\"\n          @change=\"handleStartChange\"\n          @focus=\"handleFocusInput\"\n          @blur=\"handleBlurInput\"\n        />\n        <slot name=\"range-separator\">\n          <span :class=\"nsRange.b('separator')\">{{ rangeSeparator }}</span>\n        </slot>\n        <input\n          :id=\"id && id[1]\"\n          autocomplete=\"off\"\n          :name=\"name && name[1]\"\n          :placeholder=\"endPlaceholder\"\n          :value=\"displayValue && displayValue[1]\"\n          :disabled=\"pickerDisabled\"\n          :readonly=\"!editable || readonly\"\n          :class=\"nsRange.b('input')\"\n          @mousedown=\"onMouseDownInput\"\n          @focus=\"handleFocusInput\"\n          @blur=\"handleBlurInput\"\n          @input=\"handleEndInput\"\n          @change=\"handleEndChange\"\n        />\n        <el-icon\n          v-if=\"clearIcon\"\n          :class=\"[\n            nsInput.e('icon'),\n            nsRange.e('close-icon'),\n            {\n              [nsRange.e('close-icon--hidden')]: !showClose,\n            },\n          ]\"\n          @click=\"onClearIconClick\"\n        >\n          <component :is=\"clearIcon\" />\n        </el-icon>\n      </div>\n    </template>\n    <template #content>\n      <slot\n        :visible=\"pickerVisible\"\n        :actual-visible=\"pickerActualVisible\"\n        :parsed-value=\"parsedValue\"\n        :format=\"format\"\n        :unlink-panels=\"unlinkPanels\"\n        :type=\"type\"\n        :default-value=\"defaultValue\"\n        @pick=\"onPick\"\n        @select-range=\"setSelectionRange\"\n        @set-picker-option=\"onSetPickerOption\"\n        @calendar-change=\"onCalendarChange\"\n        @panel-change=\"onPanelChange\"\n        @keydown=\"onKeydownPopperContent\"\n        @mousedown.stop\n      />\n    </template>\n  </el-tooltip>\n</template>\n<script lang=\"ts\" setup>\nimport { computed, inject, nextTick, provide, ref, unref, watch } from 'vue'\nimport { isEqual } from 'lodash-unified'\nimport { onClickOutside } from '@vueuse/core'\nimport {\n  useFormItem,\n  useLocale,\n  useNamespace,\n  useSize,\n} from '@element-plus/hooks'\nimport ElInput from '@element-plus/components/input'\nimport ElIcon from '@element-plus/components/icon'\nimport ElTooltip from '@element-plus/components/tooltip'\nimport { debugWarn, isArray } from '@element-plus/utils'\nimport { EVENT_CODE } from '@element-plus/constants'\nimport { Calendar, Clock } from '@element-plus/icons-vue'\nimport { formatter, parseDate, valueEquals } from '../utils'\nimport { timePickerDefaultProps } from './props'\n\nimport type { Dayjs } from 'dayjs'\nimport type { ComponentPublicInstance } from 'vue'\nimport type { Options } from '@popperjs/core'\nimport type {\n  DateModelType,\n  DateOrDates,\n  DayOrDays,\n  PickerOptions,\n  SingleOrRange,\n  TimePickerDefaultProps,\n  UserInput,\n} from './props'\nimport type { TooltipInstance } from '@element-plus/components/tooltip'\n\n// Date object and string\n\ndefineOptions({\n  name: 'Picker',\n})\n\nconst props = defineProps(timePickerDefaultProps)\nconst emit = defineEmits([\n  'update:modelValue',\n  'change',\n  'focus',\n  'blur',\n  'calendar-change',\n  'panel-change',\n  'visible-change',\n  'keydown',\n])\n\nconst { lang } = useLocale()\n\nconst nsDate = useNamespace('date')\nconst nsInput = useNamespace('input')\nconst nsRange = useNamespace('range')\n\nconst { form, formItem } = useFormItem()\nconst elPopperOptions = inject('ElPopperOptions', {} as Options)\n\nconst refPopper = ref<TooltipInstance>()\nconst inputRef = ref<HTMLElement | ComponentPublicInstance>()\nconst pickerVisible = ref(false)\nconst pickerActualVisible = ref(false)\nconst valueOnOpen = ref<TimePickerDefaultProps['modelValue'] | null>(null)\n\nlet hasJustTabExitedInput = false\nlet ignoreFocusEvent = false\n\nwatch(pickerVisible, (val) => {\n  if (!val) {\n    userInput.value = null\n    nextTick(() => {\n      emitChange(props.modelValue)\n    })\n  } else {\n    nextTick(() => {\n      if (val) {\n        valueOnOpen.value = props.modelValue\n      }\n    })\n  }\n})\nconst emitChange = (\n  val: TimePickerDefaultProps['modelValue'] | null,\n  isClear?: boolean\n) => {\n  // determine user real change only\n  if (isClear || !valueEquals(val, valueOnOpen.value)) {\n    emit('change', val)\n    props.validateEvent &&\n      formItem?.validate('change').catch((err) => debugWarn(err))\n  }\n}\nconst emitInput = (input: SingleOrRange<DateModelType | Dayjs> | null) => {\n  if (!valueEquals(props.modelValue, input)) {\n    let formatted\n    if (isArray(input)) {\n      formatted = input.map((item) =>\n        formatter(item, props.valueFormat, lang.value)\n      )\n    } else if (input) {\n      formatted = formatter(input, props.valueFormat, lang.value)\n    }\n    emit('update:modelValue', input ? formatted : input, lang.value)\n  }\n}\nconst emitKeydown = (e: KeyboardEvent) => {\n  emit('keydown', e)\n}\n\nconst refInput = computed<HTMLInputElement[]>(() => {\n  if (inputRef.value) {\n    const _r = isRangeInput.value\n      ? inputRef.value\n      : (inputRef.value as any as ComponentPublicInstance).$el\n    return Array.from<HTMLInputElement>(_r.querySelectorAll('input'))\n  }\n  return []\n})\n\nconst setSelectionRange = (start: number, end: number, pos?: 'min' | 'max') => {\n  const _inputs = refInput.value\n  if (!_inputs.length) return\n  if (!pos || pos === 'min') {\n    _inputs[0].setSelectionRange(start, end)\n    _inputs[0].focus()\n  } else if (pos === 'max') {\n    _inputs[1].setSelectionRange(start, end)\n    _inputs[1].focus()\n  }\n}\nconst focusOnInputBox = () => {\n  focus(true, true)\n  nextTick(() => {\n    ignoreFocusEvent = false\n  })\n}\n\nconst onPick = (date: any = '', visible = false) => {\n  if (!visible) {\n    ignoreFocusEvent = true\n  }\n  pickerVisible.value = visible\n  let result\n  if (isArray(date)) {\n    result = date.map((_) => _.toDate())\n  } else {\n    // clear btn emit null\n    result = date ? date.toDate() : date\n  }\n  userInput.value = null\n  emitInput(result)\n}\n\nconst onBeforeShow = () => {\n  pickerActualVisible.value = true\n}\n\nconst onShow = () => {\n  emit('visible-change', true)\n}\n\nconst onKeydownPopperContent = (event: KeyboardEvent) => {\n  if ((event as KeyboardEvent)?.key === EVENT_CODE.esc) {\n    focus(true, true)\n  }\n}\n\nconst onHide = () => {\n  pickerActualVisible.value = false\n  pickerVisible.value = false\n  ignoreFocusEvent = false\n  emit('visible-change', false)\n}\n\nconst handleOpen = () => {\n  pickerVisible.value = true\n}\n\nconst handleClose = () => {\n  pickerVisible.value = false\n}\n\nconst focus = (focusStartInput = true, isIgnoreFocusEvent = false) => {\n  ignoreFocusEvent = isIgnoreFocusEvent\n  const [leftInput, rightInput] = unref(refInput)\n  let input = leftInput\n  if (!focusStartInput && isRangeInput.value) {\n    input = rightInput\n  }\n  if (input) {\n    input.focus()\n  }\n}\n\nconst handleFocusInput = (e?: FocusEvent) => {\n  if (\n    props.readonly ||\n    pickerDisabled.value ||\n    pickerVisible.value ||\n    ignoreFocusEvent\n  ) {\n    return\n  }\n  pickerVisible.value = true\n  emit('focus', e)\n}\n\nlet currentHandleBlurDeferCallback:\n  | (() => Promise<void> | undefined)\n  | undefined = undefined\n\n// Check if document.activeElement is inside popper or any input before popper close\nconst handleBlurInput = (e?: FocusEvent) => {\n  const handleBlurDefer = async () => {\n    setTimeout(() => {\n      if (currentHandleBlurDeferCallback === handleBlurDefer) {\n        if (\n          !(\n            refPopper.value?.isFocusInsideContent() && !hasJustTabExitedInput\n          ) &&\n          refInput.value.filter((input) => {\n            return input.contains(document.activeElement)\n          }).length === 0\n        ) {\n          handleChange()\n          pickerVisible.value = false\n          emit('blur', e)\n          props.validateEvent &&\n            formItem?.validate('blur').catch((err) => debugWarn(err))\n        }\n        hasJustTabExitedInput = false\n      }\n    }, 0)\n  }\n  currentHandleBlurDeferCallback = handleBlurDefer\n  handleBlurDefer()\n}\n\nconst pickerDisabled = computed(() => {\n  return props.disabled || form?.disabled\n})\n\nconst parsedValue = computed(() => {\n  let dayOrDays: DayOrDays\n  if (valueIsEmpty.value) {\n    if (pickerOptions.value.getDefaultValue) {\n      dayOrDays = pickerOptions.value.getDefaultValue()\n    }\n  } else {\n    if (isArray(props.modelValue)) {\n      dayOrDays = props.modelValue.map((d) =>\n        parseDate(d, props.valueFormat, lang.value)\n      ) as [Dayjs, Dayjs]\n    } else {\n      dayOrDays = parseDate(props.modelValue, props.valueFormat, lang.value)!\n    }\n  }\n\n  if (pickerOptions.value.getRangeAvailableTime) {\n    const availableResult = pickerOptions.value.getRangeAvailableTime(\n      dayOrDays!\n    )\n    if (!isEqual(availableResult, dayOrDays!)) {\n      dayOrDays = availableResult\n      emitInput(\n        (isArray(dayOrDays)\n          ? dayOrDays.map((_) => _.toDate())\n          : dayOrDays.toDate()) as SingleOrRange<Date>\n      )\n    }\n  }\n  if (isArray(dayOrDays!) && dayOrDays.some((day) => !day)) {\n    dayOrDays = [] as unknown as DayOrDays\n  }\n  return dayOrDays!\n})\n\nconst displayValue = computed<UserInput>(() => {\n  if (!pickerOptions.value.panelReady) return ''\n  const formattedValue = formatDayjsToString(parsedValue.value)\n  if (isArray(userInput.value)) {\n    return [\n      userInput.value[0] || (formattedValue && formattedValue[0]) || '',\n      userInput.value[1] || (formattedValue && formattedValue[1]) || '',\n    ]\n  } else if (userInput.value !== null) {\n    return userInput.value\n  }\n  if (!isTimePicker.value && valueIsEmpty.value) return ''\n  if (!pickerVisible.value && valueIsEmpty.value) return ''\n  if (formattedValue) {\n    return isDatesPicker.value\n      ? (formattedValue as Array<string>).join(', ')\n      : formattedValue\n  }\n  return ''\n})\n\nconst isTimeLikePicker = computed(() => props.type.includes('time'))\n\nconst isTimePicker = computed(() => props.type.startsWith('time'))\n\nconst isDatesPicker = computed(() => props.type === 'dates')\n\nconst triggerIcon = computed(\n  () => props.prefixIcon || (isTimeLikePicker.value ? Clock : Calendar)\n)\n\nconst showClose = ref(false)\n\nconst onClearIconClick = (event: MouseEvent) => {\n  if (props.readonly || pickerDisabled.value) return\n  if (showClose.value) {\n    event.stopPropagation()\n    focusOnInputBox()\n    emitInput(null)\n    emitChange(null, true)\n    showClose.value = false\n    pickerVisible.value = false\n    pickerOptions.value.handleClear && pickerOptions.value.handleClear()\n  }\n}\n\nconst valueIsEmpty = computed(() => {\n  const { modelValue } = props\n  return (\n    !modelValue || (isArray(modelValue) && !modelValue.filter(Boolean).length)\n  )\n})\n\nconst onMouseDownInput = async (event: MouseEvent) => {\n  if (props.readonly || pickerDisabled.value) return\n  if (\n    (event.target as HTMLElement)?.tagName !== 'INPUT' ||\n    refInput.value.includes(document.activeElement as HTMLInputElement)\n  ) {\n    pickerVisible.value = true\n  }\n}\nconst onMouseEnter = () => {\n  if (props.readonly || pickerDisabled.value) return\n  if (!valueIsEmpty.value && props.clearable) {\n    showClose.value = true\n  }\n}\nconst onMouseLeave = () => {\n  showClose.value = false\n}\nconst onTouchStartInput = (event: TouchEvent) => {\n  if (\n    (event.touches[0].target as HTMLElement)?.tagName !== 'INPUT' ||\n    refInput.value.includes(document.activeElement as HTMLInputElement)\n  ) {\n    pickerVisible.value = true\n  }\n}\nconst isRangeInput = computed(() => {\n  return props.type.includes('range')\n})\n\nconst pickerSize = useSize()\n\nconst popperEl = computed(() => unref(refPopper)?.popperRef?.contentRef)\nconst actualInputRef = computed(() => {\n  if (unref(isRangeInput)) {\n    return unref(inputRef)\n  }\n\n  return (unref(inputRef) as ComponentPublicInstance)?.$el\n})\n\nonClickOutside(actualInputRef, (e: PointerEvent) => {\n  const unrefedPopperEl = unref(popperEl)\n  const inputEl = unref(actualInputRef)\n  if (\n    (unrefedPopperEl &&\n      (e.target === unrefedPopperEl ||\n        e.composedPath().includes(unrefedPopperEl))) ||\n    e.target === inputEl ||\n    e.composedPath().includes(inputEl)\n  )\n    return\n  pickerVisible.value = false\n})\n\nconst userInput = ref<UserInput>(null)\n\nconst handleChange = () => {\n  if (userInput.value) {\n    const value = parseUserInputToDayjs(displayValue.value)\n    if (value) {\n      if (isValidValue(value)) {\n        emitInput(\n          (isArray(value)\n            ? value.map((_) => _.toDate())\n            : value.toDate()) as DateOrDates\n        )\n        userInput.value = null\n      }\n    }\n  }\n  if (userInput.value === '') {\n    emitInput(null)\n    emitChange(null)\n    userInput.value = null\n  }\n}\n\nconst parseUserInputToDayjs = (value: UserInput) => {\n  if (!value) return null\n  return pickerOptions.value.parseUserInput!(value)\n}\n\nconst formatDayjsToString = (value: DayOrDays) => {\n  if (!value) return null\n  return pickerOptions.value.formatToString!(value)\n}\n\nconst isValidValue = (value: DayOrDays) => {\n  return pickerOptions.value.isValidValue!(value)\n}\n\nconst handleKeydownInput = async (event: KeyboardEvent) => {\n  if (props.readonly || pickerDisabled.value) return\n\n  const { code } = event\n  emitKeydown(event)\n  if (code === EVENT_CODE.esc) {\n    if (pickerVisible.value === true) {\n      pickerVisible.value = false\n      event.preventDefault()\n      event.stopPropagation()\n    }\n    return\n  }\n\n  if (code === EVENT_CODE.down) {\n    if (pickerOptions.value.handleFocusPicker) {\n      event.preventDefault()\n      event.stopPropagation()\n    }\n    if (pickerVisible.value === false) {\n      pickerVisible.value = true\n      await nextTick()\n    }\n    if (pickerOptions.value.handleFocusPicker) {\n      pickerOptions.value.handleFocusPicker()\n      return\n    }\n  }\n\n  if (code === EVENT_CODE.tab) {\n    hasJustTabExitedInput = true\n    return\n  }\n\n  if (code === EVENT_CODE.enter || code === EVENT_CODE.numpadEnter) {\n    if (\n      userInput.value === null ||\n      userInput.value === '' ||\n      isValidValue(parseUserInputToDayjs(displayValue.value) as DayOrDays)\n    ) {\n      handleChange()\n      pickerVisible.value = false\n    }\n    event.stopPropagation()\n    return\n  }\n\n  // if user is typing, do not let picker handle key input\n  if (userInput.value) {\n    event.stopPropagation()\n    return\n  }\n  if (pickerOptions.value.handleKeydownInput) {\n    pickerOptions.value.handleKeydownInput(event)\n  }\n}\nconst onUserInput = (e: string) => {\n  userInput.value = e\n  // Temporary fix when the picker is dismissed and the input box\n  // is focused, just mimic the behavior of antdesign.\n  if (!pickerVisible.value) {\n    pickerVisible.value = true\n  }\n}\n\nconst handleStartInput = (event: Event) => {\n  const target = event.target as HTMLInputElement\n  if (userInput.value) {\n    userInput.value = [target.value, userInput.value[1]]\n  } else {\n    userInput.value = [target.value, null]\n  }\n}\n\nconst handleEndInput = (event: Event) => {\n  const target = event.target as HTMLInputElement\n  if (userInput.value) {\n    userInput.value = [userInput.value[0], target.value]\n  } else {\n    userInput.value = [null, target.value]\n  }\n}\n\nconst handleStartChange = () => {\n  const values = userInput.value as string[]\n  const value = parseUserInputToDayjs(values && values[0]) as Dayjs\n  const parsedVal = unref(parsedValue) as [Dayjs, Dayjs]\n  if (value && value.isValid()) {\n    userInput.value = [\n      formatDayjsToString(value) as string,\n      displayValue.value?.[1] || null,\n    ]\n    const newValue = [value, parsedVal && (parsedVal[1] || null)] as DayOrDays\n    if (isValidValue(newValue)) {\n      emitInput(newValue)\n      userInput.value = null\n    }\n  }\n}\n\nconst handleEndChange = () => {\n  const values = unref(userInput) as string[]\n  const value = parseUserInputToDayjs(values && values[1]) as Dayjs\n  const parsedVal = unref(parsedValue) as [Dayjs, Dayjs]\n  if (value && value.isValid()) {\n    userInput.value = [\n      unref(displayValue)?.[0] || null,\n      formatDayjsToString(value) as string,\n    ]\n    const newValue = [parsedVal && parsedVal[0], value] as DayOrDays\n    if (isValidValue(newValue)) {\n      emitInput(newValue)\n      userInput.value = null\n    }\n  }\n}\n\nconst pickerOptions = ref<Partial<PickerOptions>>({})\nconst onSetPickerOption = <T extends keyof PickerOptions>(\n  e: [T, PickerOptions[T]]\n) => {\n  pickerOptions.value[e[0]] = e[1]\n  pickerOptions.value.panelReady = true\n}\n\nconst onCalendarChange = (e: [Date, false | Date]) => {\n  emit('calendar-change', e)\n}\n\nconst onPanelChange = (\n  value: [Dayjs, Dayjs],\n  mode: 'month' | 'year',\n  view: unknown\n) => {\n  emit('panel-change', value, mode, view)\n}\n\nprovide('EP_PICKER_BASE', {\n  props,\n})\n\ndefineExpose({\n  /**\n   * @description focus input box.\n   */\n  focus,\n  /**\n   * @description emit focus event\n   */\n  handleFocusInput,\n  /**\n   * @description emit blur event\n   */\n  handleBlurInput,\n  /**\n   * @description opens picker\n   */\n  handleOpen,\n  /**\n   * @description closes picker\n   */\n  handleClose,\n  /**\n   * @description pick item manually\n   */\n  onPick,\n})\n</script>\n"]},"metadata":{},"sourceType":"module"}