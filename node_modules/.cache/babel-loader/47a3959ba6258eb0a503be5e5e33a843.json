{"ast":null,"code":"import { defineComponent, inject, ref, computed, markRaw, watch, openBlock, createElementBlock, unref, normalizeClass, normalizeStyle, Fragment, renderList, createVNode, withCtx, withDirectives, createBlock, resolveDynamicComponent, vShow, createCommentVNode, toDisplayString } from 'vue';\nimport '../../../constants/index.mjs';\nimport '../../../utils/index.mjs';\nimport '../../../tokens/index.mjs';\nimport { ElIcon } from '../../icon/index.mjs';\nimport '../../../hooks/index.mjs';\nimport { rateProps, rateEmits } from './rate.mjs';\nimport _export_sfc from '../../../_virtual/plugin-vue_export-helper.mjs';\nimport { isObject, isArray, isString } from '@vue/shared';\nimport { formContextKey, formItemContextKey } from '../../../tokens/form.mjs';\nimport { useSize } from '../../../hooks/use-common-props/index.mjs';\nimport { useNamespace } from '../../../hooks/use-namespace/index.mjs';\nimport { useFormItemInputId } from '../../../hooks/use-form-item/index.mjs';\nimport { UPDATE_MODEL_EVENT } from '../../../constants/event.mjs';\nimport { EVENT_CODE } from '../../../constants/aria.mjs';\nimport { hasClass } from '../../../utils/dom/style.mjs';\nconst _hoisted_1 = [\"id\", \"aria-label\", \"aria-labelledby\", \"aria-valuenow\", \"aria-valuetext\", \"aria-valuemax\"];\nconst _hoisted_2 = [\"onMousemove\", \"onClick\"];\n\nconst __default__ = defineComponent({\n  name: \"ElRate\"\n});\n\nconst _sfc_main = /* @__PURE__ */defineComponent({ ...__default__,\n  props: rateProps,\n  emits: rateEmits,\n\n  setup(__props, {\n    expose,\n    emit\n  }) {\n    const props = __props;\n\n    function getValueFromMap(value, map) {\n      const isExcludedObject = val => isObject(val);\n\n      const matchedKeys = Object.keys(map).map(key => +key).filter(key => {\n        const val = map[key];\n        const excluded = isExcludedObject(val) ? val.excluded : false;\n        return excluded ? value < key : value <= key;\n      }).sort((a, b) => a - b);\n      const matchedValue = map[matchedKeys[0]];\n      return isExcludedObject(matchedValue) && matchedValue.value || matchedValue;\n    }\n\n    const formContext = inject(formContextKey, void 0);\n    const formItemContext = inject(formItemContextKey, void 0);\n    const rateSize = useSize();\n    const ns = useNamespace(\"rate\");\n    const {\n      inputId,\n      isLabeledByFormItem\n    } = useFormItemInputId(props, {\n      formItemContext\n    });\n    const currentValue = ref(props.modelValue);\n    const hoverIndex = ref(-1);\n    const pointerAtLeftHalf = ref(true);\n    const rateClasses = computed(() => [ns.b(), ns.m(rateSize.value)]);\n    const rateDisabled = computed(() => props.disabled || (formContext == null ? void 0 : formContext.disabled));\n    const rateStyles = computed(() => {\n      return ns.cssVarBlock({\n        \"void-color\": props.voidColor,\n        \"disabled-void-color\": props.disabledVoidColor,\n        \"fill-color\": activeColor.value\n      });\n    });\n    const text = computed(() => {\n      let result = \"\";\n\n      if (props.showScore) {\n        result = props.scoreTemplate.replace(/\\{\\s*value\\s*\\}/, rateDisabled.value ? `${props.modelValue}` : `${currentValue.value}`);\n      } else if (props.showText) {\n        result = props.texts[Math.ceil(currentValue.value) - 1];\n      }\n\n      return result;\n    });\n    const valueDecimal = computed(() => props.modelValue * 100 - Math.floor(props.modelValue) * 100);\n    const colorMap = computed(() => isArray(props.colors) ? {\n      [props.lowThreshold]: props.colors[0],\n      [props.highThreshold]: {\n        value: props.colors[1],\n        excluded: true\n      },\n      [props.max]: props.colors[2]\n    } : props.colors);\n    const activeColor = computed(() => {\n      const color = getValueFromMap(currentValue.value, colorMap.value);\n      return isObject(color) ? \"\" : color;\n    });\n    const decimalStyle = computed(() => {\n      let width = \"\";\n\n      if (rateDisabled.value) {\n        width = `${valueDecimal.value}%`;\n      } else if (props.allowHalf) {\n        width = \"50%\";\n      }\n\n      return {\n        color: activeColor.value,\n        width\n      };\n    });\n    const componentMap = computed(() => {\n      let icons = isArray(props.icons) ? [...props.icons] : { ...props.icons\n      };\n      icons = markRaw(icons);\n      return isArray(icons) ? {\n        [props.lowThreshold]: icons[0],\n        [props.highThreshold]: {\n          value: icons[1],\n          excluded: true\n        },\n        [props.max]: icons[2]\n      } : icons;\n    });\n    const decimalIconComponent = computed(() => getValueFromMap(props.modelValue, componentMap.value));\n    const voidComponent = computed(() => rateDisabled.value ? isString(props.disabledVoidIcon) ? props.disabledVoidIcon : markRaw(props.disabledVoidIcon) : isString(props.voidIcon) ? props.voidIcon : markRaw(props.voidIcon));\n    const activeComponent = computed(() => getValueFromMap(currentValue.value, componentMap.value));\n\n    function showDecimalIcon(item) {\n      const showWhenDisabled = rateDisabled.value && valueDecimal.value > 0 && item - 1 < props.modelValue && item > props.modelValue;\n      const showWhenAllowHalf = props.allowHalf && pointerAtLeftHalf.value && item - 0.5 <= currentValue.value && item > currentValue.value;\n      return showWhenDisabled || showWhenAllowHalf;\n    }\n\n    function emitValue(value) {\n      if (props.clearable && value === props.modelValue) {\n        value = 0;\n      }\n\n      emit(UPDATE_MODEL_EVENT, value);\n\n      if (props.modelValue !== value) {\n        emit(\"change\", value);\n      }\n    }\n\n    function selectValue(value) {\n      if (rateDisabled.value) {\n        return;\n      }\n\n      if (props.allowHalf && pointerAtLeftHalf.value) {\n        emitValue(currentValue.value);\n      } else {\n        emitValue(value);\n      }\n    }\n\n    function handleKey(e) {\n      if (rateDisabled.value) {\n        return;\n      }\n\n      let _currentValue = currentValue.value;\n      const code = e.code;\n\n      if (code === EVENT_CODE.up || code === EVENT_CODE.right) {\n        if (props.allowHalf) {\n          _currentValue += 0.5;\n        } else {\n          _currentValue += 1;\n        }\n\n        e.stopPropagation();\n        e.preventDefault();\n      } else if (code === EVENT_CODE.left || code === EVENT_CODE.down) {\n        if (props.allowHalf) {\n          _currentValue -= 0.5;\n        } else {\n          _currentValue -= 1;\n        }\n\n        e.stopPropagation();\n        e.preventDefault();\n      }\n\n      _currentValue = _currentValue < 0 ? 0 : _currentValue;\n      _currentValue = _currentValue > props.max ? props.max : _currentValue;\n      emit(UPDATE_MODEL_EVENT, _currentValue);\n      emit(\"change\", _currentValue);\n      return _currentValue;\n    }\n\n    function setCurrentValue(value, event) {\n      if (rateDisabled.value) {\n        return;\n      }\n\n      if (props.allowHalf) {\n        let target = event.target;\n\n        if (hasClass(target, ns.e(\"item\"))) {\n          target = target.querySelector(`.${ns.e(\"icon\")}`);\n        }\n\n        if (target.clientWidth === 0 || hasClass(target, ns.e(\"decimal\"))) {\n          target = target.parentNode;\n        }\n\n        pointerAtLeftHalf.value = event.offsetX * 2 <= target.clientWidth;\n        currentValue.value = pointerAtLeftHalf.value ? value - 0.5 : value;\n      } else {\n        currentValue.value = value;\n      }\n\n      hoverIndex.value = value;\n    }\n\n    function resetCurrentValue() {\n      if (rateDisabled.value) {\n        return;\n      }\n\n      if (props.allowHalf) {\n        pointerAtLeftHalf.value = props.modelValue !== Math.floor(props.modelValue);\n      }\n\n      currentValue.value = props.modelValue;\n      hoverIndex.value = -1;\n    }\n\n    watch(() => props.modelValue, val => {\n      currentValue.value = val;\n      pointerAtLeftHalf.value = props.modelValue !== Math.floor(props.modelValue);\n    });\n\n    if (!props.modelValue) {\n      emit(UPDATE_MODEL_EVENT, 0);\n    }\n\n    expose({\n      setCurrentValue,\n      resetCurrentValue\n    });\n    return (_ctx, _cache) => {\n      var _a;\n\n      return openBlock(), createElementBlock(\"div\", {\n        id: unref(inputId),\n        class: normalizeClass([unref(rateClasses), unref(ns).is(\"disabled\", unref(rateDisabled))]),\n        role: \"slider\",\n        \"aria-label\": !unref(isLabeledByFormItem) ? _ctx.label || \"rating\" : void 0,\n        \"aria-labelledby\": unref(isLabeledByFormItem) ? (_a = unref(formItemContext)) == null ? void 0 : _a.labelId : void 0,\n        \"aria-valuenow\": currentValue.value,\n        \"aria-valuetext\": unref(text) || void 0,\n        \"aria-valuemin\": \"0\",\n        \"aria-valuemax\": _ctx.max,\n        tabindex: \"0\",\n        style: normalizeStyle(unref(rateStyles)),\n        onKeydown: handleKey\n      }, [(openBlock(true), createElementBlock(Fragment, null, renderList(_ctx.max, (item, key) => {\n        return openBlock(), createElementBlock(\"span\", {\n          key,\n          class: normalizeClass(unref(ns).e(\"item\")),\n          onMousemove: $event => setCurrentValue(item, $event),\n          onMouseleave: resetCurrentValue,\n          onClick: $event => selectValue(item)\n        }, [createVNode(unref(ElIcon), {\n          class: normalizeClass([unref(ns).e(\"icon\"), {\n            hover: hoverIndex.value === item\n          }, unref(ns).is(\"active\", item <= currentValue.value)])\n        }, {\n          default: withCtx(() => [!showDecimalIcon(item) ? (openBlock(), createElementBlock(Fragment, {\n            key: 0\n          }, [withDirectives((openBlock(), createBlock(resolveDynamicComponent(unref(activeComponent)), null, null, 512)), [[vShow, item <= currentValue.value]]), withDirectives((openBlock(), createBlock(resolveDynamicComponent(unref(voidComponent)), null, null, 512)), [[vShow, !(item <= currentValue.value)]])], 64)) : createCommentVNode(\"v-if\", true), showDecimalIcon(item) ? (openBlock(), createBlock(unref(ElIcon), {\n            key: 1,\n            style: normalizeStyle(unref(decimalStyle)),\n            class: normalizeClass([unref(ns).e(\"icon\"), unref(ns).e(\"decimal\")])\n          }, {\n            default: withCtx(() => [(openBlock(), createBlock(resolveDynamicComponent(unref(decimalIconComponent))))]),\n            _: 1\n          }, 8, [\"style\", \"class\"])) : createCommentVNode(\"v-if\", true)]),\n          _: 2\n        }, 1032, [\"class\"])], 42, _hoisted_2);\n      }), 128)), _ctx.showText || _ctx.showScore ? (openBlock(), createElementBlock(\"span\", {\n        key: 0,\n        class: normalizeClass(unref(ns).e(\"text\"))\n      }, toDisplayString(unref(text)), 3)) : createCommentVNode(\"v-if\", true)], 46, _hoisted_1);\n    };\n  }\n\n});\n\nvar Rate = /* @__PURE__ */_export_sfc(_sfc_main, [[\"__file\", \"/home/runner/work/element-plus/element-plus/packages/components/rate/src/rate.vue\"]]);\n\nexport { Rate as default };","map":{"version":3,"mappings":"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","names":["name","value","map","isExcludedObject","val","isObject","matchedKeys","keys","key","filter","excluded","sort","a","b","matchedValue","inject","rateSize","useSize","useNamespace","inputId","isLabeledByFormItem","useFormItemInputId","props","formItemContext","ref","modelValue","rateClasses","ns","m","rateDisabled","computed","formContext","cssVarBlock","activeColor","result","showScore","scoreTemplate","replace","showText","texts","Math","ceil","currentValue","floor","colorMap","isArray","colors","lowThreshold","highThreshold","max","color","width","valueDecimal","allowHalf","icons","markRaw","getValueFromMap","componentMap","isString","disabledVoidIcon","voidIcon","item","pointerAtLeftHalf","showWhenDisabled","emit","UPDATE_MODEL_EVENT","emitValue","e","_currentValue","code","up","EVENT_CODE","right","stopPropagation","preventDefault","left","down","event","target","hasClass","querySelector","clientWidth","offsetX","hoverIndex","watch","expose","setCurrentValue","resetCurrentValue"],"sources":["../../../../../../packages/components/rate/src/rate.vue"],"sourcesContent":["<template>\n  <div\n    :id=\"inputId\"\n    :class=\"[rateClasses, ns.is('disabled', rateDisabled)]\"\n    role=\"slider\"\n    :aria-label=\"!isLabeledByFormItem ? label || 'rating' : undefined\"\n    :aria-labelledby=\"\n      isLabeledByFormItem ? formItemContext?.labelId : undefined\n    \"\n    :aria-valuenow=\"currentValue\"\n    :aria-valuetext=\"text || undefined\"\n    aria-valuemin=\"0\"\n    :aria-valuemax=\"max\"\n    tabindex=\"0\"\n    :style=\"rateStyles\"\n    @keydown=\"handleKey\"\n  >\n    <span\n      v-for=\"(item, key) in max\"\n      :key=\"key\"\n      :class=\"ns.e('item')\"\n      @mousemove=\"setCurrentValue(item, $event)\"\n      @mouseleave=\"resetCurrentValue\"\n      @click=\"selectValue(item)\"\n    >\n      <el-icon\n        :class=\"[\n          ns.e('icon'),\n          { hover: hoverIndex === item },\n          ns.is('active', item <= currentValue),\n        ]\"\n      >\n        <template v-if=\"!showDecimalIcon(item)\">\n          <component :is=\"activeComponent\" v-show=\"item <= currentValue\" />\n          <component :is=\"voidComponent\" v-show=\"!(item <= currentValue)\" />\n        </template>\n        <el-icon\n          v-if=\"showDecimalIcon(item)\"\n          :style=\"decimalStyle\"\n          :class=\"[ns.e('icon'), ns.e('decimal')]\"\n        >\n          <component :is=\"decimalIconComponent\" />\n        </el-icon>\n      </el-icon>\n    </span>\n    <span v-if=\"showText || showScore\" :class=\"ns.e('text')\">\n      {{ text }}\n    </span>\n  </div>\n</template>\n<script lang=\"ts\" setup>\nimport { computed, inject, markRaw, ref, watch } from 'vue'\nimport { EVENT_CODE, UPDATE_MODEL_EVENT } from '@element-plus/constants'\nimport { hasClass, isArray, isObject, isString } from '@element-plus/utils'\nimport { formContextKey, formItemContextKey } from '@element-plus/tokens'\nimport { ElIcon } from '@element-plus/components/icon'\nimport { useFormItemInputId, useNamespace, useSize } from '@element-plus/hooks'\nimport { rateEmits, rateProps } from './rate'\nimport type { iconPropType } from '@element-plus/utils'\nimport type { CSSProperties, Component } from 'vue'\n\nfunction getValueFromMap<T>(\n  value: number,\n  map: Record<string, T | { excluded?: boolean; value: T }>\n) {\n  const isExcludedObject = (\n    val: unknown\n  ): val is { excluded?: boolean } & Record<any, unknown> => isObject(val)\n\n  const matchedKeys = Object.keys(map)\n    .map((key) => +key)\n    .filter((key) => {\n      const val = map[key]\n      const excluded = isExcludedObject(val) ? val.excluded : false\n      return excluded ? value < key : value <= key\n    })\n    .sort((a, b) => a - b)\n  const matchedValue = map[matchedKeys[0]]\n  return (isExcludedObject(matchedValue) && matchedValue.value) || matchedValue\n}\n\ndefineOptions({\n  name: 'ElRate',\n})\n\nconst props = defineProps(rateProps)\nconst emit = defineEmits(rateEmits)\n\nconst formContext = inject(formContextKey, undefined)\nconst formItemContext = inject(formItemContextKey, undefined)\nconst rateSize = useSize()\nconst ns = useNamespace('rate')\nconst { inputId, isLabeledByFormItem } = useFormItemInputId(props, {\n  formItemContext,\n})\n\nconst currentValue = ref(props.modelValue)\nconst hoverIndex = ref(-1)\nconst pointerAtLeftHalf = ref(true)\n\nconst rateClasses = computed(() => [ns.b(), ns.m(rateSize.value)])\nconst rateDisabled = computed(() => props.disabled || formContext?.disabled)\nconst rateStyles = computed(() => {\n  return ns.cssVarBlock({\n    'void-color': props.voidColor,\n    'disabled-void-color': props.disabledVoidColor,\n    'fill-color': activeColor.value,\n  }) as CSSProperties\n})\n\nconst text = computed(() => {\n  let result = ''\n  if (props.showScore) {\n    result = props.scoreTemplate.replace(\n      /\\{\\s*value\\s*\\}/,\n      rateDisabled.value ? `${props.modelValue}` : `${currentValue.value}`\n    )\n  } else if (props.showText) {\n    result = props.texts[Math.ceil(currentValue.value) - 1]\n  }\n  return result\n})\nconst valueDecimal = computed(\n  () => props.modelValue * 100 - Math.floor(props.modelValue) * 100\n)\nconst colorMap = computed(() =>\n  isArray(props.colors)\n    ? {\n        [props.lowThreshold]: props.colors[0],\n        [props.highThreshold]: { value: props.colors[1], excluded: true },\n        [props.max]: props.colors[2],\n      }\n    : props.colors\n)\nconst activeColor = computed(() => {\n  const color = getValueFromMap(currentValue.value, colorMap.value)\n  // {value: '', excluded: true} returned\n  return isObject(color) ? '' : color\n})\nconst decimalStyle = computed(() => {\n  let width = ''\n  if (rateDisabled.value) {\n    width = `${valueDecimal.value}%`\n  } else if (props.allowHalf) {\n    width = '50%'\n  }\n  return {\n    color: activeColor.value,\n    width,\n  }\n})\nconst componentMap = computed(() => {\n  let icons = isArray(props.icons) ? [...props.icons] : { ...props.icons }\n  icons = markRaw(icons) as\n    | Array<string | Component>\n    | Record<number, string | Component>\n  return isArray(icons)\n    ? {\n        [props.lowThreshold]: icons[0],\n        [props.highThreshold]: {\n          value: icons[1],\n          excluded: true,\n        },\n        [props.max]: icons[2],\n      }\n    : icons\n})\nconst decimalIconComponent = computed(() =>\n  getValueFromMap(props.modelValue, componentMap.value)\n)\nconst voidComponent = computed(() =>\n  rateDisabled.value\n    ? isString(props.disabledVoidIcon)\n      ? props.disabledVoidIcon\n      : (markRaw(props.disabledVoidIcon) as typeof iconPropType)\n    : isString(props.voidIcon)\n    ? props.voidIcon\n    : (markRaw(props.voidIcon) as typeof iconPropType)\n)\nconst activeComponent = computed(() =>\n  getValueFromMap(currentValue.value, componentMap.value)\n)\n\nfunction showDecimalIcon(item: number) {\n  const showWhenDisabled =\n    rateDisabled.value &&\n    valueDecimal.value > 0 &&\n    item - 1 < props.modelValue &&\n    item > props.modelValue\n  const showWhenAllowHalf =\n    props.allowHalf &&\n    pointerAtLeftHalf.value &&\n    item - 0.5 <= currentValue.value &&\n    item > currentValue.value\n  return showWhenDisabled || showWhenAllowHalf\n}\n\nfunction emitValue(value: number) {\n  // if allow clear, and selected value is same as modelValue, reset value to 0\n  if (props.clearable && value === props.modelValue) {\n    value = 0\n  }\n\n  emit(UPDATE_MODEL_EVENT, value)\n  if (props.modelValue !== value) {\n    emit('change', value)\n  }\n}\n\nfunction selectValue(value: number) {\n  if (rateDisabled.value) {\n    return\n  }\n  if (props.allowHalf && pointerAtLeftHalf.value) {\n    emitValue(currentValue.value)\n  } else {\n    emitValue(value)\n  }\n}\n\nfunction handleKey(e: KeyboardEvent) {\n  if (rateDisabled.value) {\n    return\n  }\n  let _currentValue = currentValue.value\n  const code = e.code\n  if (code === EVENT_CODE.up || code === EVENT_CODE.right) {\n    if (props.allowHalf) {\n      _currentValue += 0.5\n    } else {\n      _currentValue += 1\n    }\n    e.stopPropagation()\n    e.preventDefault()\n  } else if (code === EVENT_CODE.left || code === EVENT_CODE.down) {\n    if (props.allowHalf) {\n      _currentValue -= 0.5\n    } else {\n      _currentValue -= 1\n    }\n    e.stopPropagation()\n    e.preventDefault()\n  }\n  _currentValue = _currentValue < 0 ? 0 : _currentValue\n  _currentValue = _currentValue > props.max ? props.max : _currentValue\n  emit(UPDATE_MODEL_EVENT, _currentValue)\n  emit('change', _currentValue)\n  return _currentValue\n}\n\nfunction setCurrentValue(value: number, event: MouseEvent) {\n  if (rateDisabled.value) {\n    return\n  }\n  if (props.allowHalf) {\n    // TODO: use cache via computed https://github.com/element-plus/element-plus/pull/5456#discussion_r786472092\n    let target = event.target as HTMLElement\n    if (hasClass(target, ns.e('item'))) {\n      target = target.querySelector(`.${ns.e('icon')}`)!\n    }\n    if (target.clientWidth === 0 || hasClass(target, ns.e('decimal'))) {\n      target = target.parentNode as HTMLElement\n    }\n    pointerAtLeftHalf.value = event.offsetX * 2 <= target.clientWidth\n    currentValue.value = pointerAtLeftHalf.value ? value - 0.5 : value\n  } else {\n    currentValue.value = value\n  }\n  hoverIndex.value = value\n}\n\nfunction resetCurrentValue() {\n  if (rateDisabled.value) {\n    return\n  }\n  if (props.allowHalf) {\n    pointerAtLeftHalf.value = props.modelValue !== Math.floor(props.modelValue)\n  }\n  currentValue.value = props.modelValue\n  hoverIndex.value = -1\n}\n\nwatch(\n  () => props.modelValue,\n  (val) => {\n    currentValue.value = val\n    pointerAtLeftHalf.value = props.modelValue !== Math.floor(props.modelValue)\n  }\n)\n\nif (!props.modelValue) {\n  emit(UPDATE_MODEL_EVENT, 0)\n}\n\ndefineExpose({\n  /** @description set current value */\n  setCurrentValue,\n  /** @description reset current value */\n  resetCurrentValue,\n})\n</script>\n"]},"metadata":{},"sourceType":"module"}